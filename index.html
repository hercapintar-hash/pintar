<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Catatan Pintar Pelajar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body{font-family:Arial;background:#f3f4f6;margin:0}
    header{background:#2563eb;color:#fff;padding:40px 20px;text-align:center}
    section{max-width:800px;margin:auto;padding:20px}
    .box{background:#fff;padding:20px;border-radius:12px;margin-top:20px}
    input,textarea,button{
      width:100%;padding:12px;margin-top:10px;
      border-radius:8px;border:1px solid #ccc
    }
    button{background:#22c55e;color:#fff;font-weight:bold}
    .note{background:#e5e7eb;padding:10px;border-radius:8px;margin-top:10px}
  </style>
</head>

<body>

<header>
  <h1>üìò Catatan Pintar Pelajar</h1>
  <p>Simpan catatan sekolahmu dengan aman</p>
</header>

<section id="auth" class="box">
  <h3>Login / Daftar</h3>
  <input id="email" type="email">
<input id="password" type="password">
  <button onclick="login()">Masuk / Daftar</button>
</section>

<section id="app" class="box" style="display:none">
  <h3>Tulis Catatan</h3>
  <textarea id="note" placeholder="Tulis catatan pelajaran..."></textarea>
  <button onclick="saveNote()">Simpan Catatan</button>

<h3>Catatan Kamu</h3>
<p id="limitMsg" style="color:red;display:none">
  ‚ö†Ô∏è Batas gratis 20 catatan tercapai. Upgrade ke Premium.
</p>
<div id="notes"></div>
  <button onclick="logout()">Logout</button>
</section>

<script>
  // üî• GANTI DENGAN CONFIG FIREBASE KAMU
  const firebaseConfig = {
  apiKey: "AIzaSyAAGUOH279hOTJ-uG1UXlRUEkC6Bdf0_aU",
  authDomain: "pelajarpintar-69f9a.firebaseapp.com",
  projectId: "pelajarpintar-69f9a",

  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // ‚úÖ DEFINISIKAN SEMUA ELEMENT DULU
  const authSection = document.getElementById("auth");
  const appSection = document.getElementById("app");
  const emailInput = document.getElementById("email");
  const passwordInput = document.getElementById("password");
  const noteInput = document.getElementById("note");
  const notesDiv = document.getElementById("notes");
  const limitMsg = document.getElementById("limitMsg");

  function login(){
    auth.signInWithEmailAndPassword(
      emailInput.value,
      passwordInput.value
    ).catch(()=>{
      auth.createUserWithEmailAndPassword(
        emailInput.value,
        passwordInput.value
      );
    });
  }

  auth.onAuthStateChanged(user=>{
    if(user){
      authSection.style.display = "none";
      appSection.style.display = "block";
      loadNotes();
    }
  });

  function saveNote(){
    const user = auth.currentUser;

    db.collection("notes")
      .where("uid","==",user.uid)
      .get()
      .then(snapshot=>{
        if(snapshot.size >= 20){
          limitMsg.style.display = "block";
          return;
        }

        db.collection("notes").add({
          uid: user.uid,
          text: noteInput.value,
          time: Date.now()
        }).then(()=>{
          noteInput.value = "";
          loadNotes();
        });
      });
  }

  function loadNotes(){
    notesDiv.innerHTML = "";
    limitMsg.style.display = "none";

    const user = auth.currentUser;
    db.collection("notes")
      .where("uid","==",user.uid)
      .orderBy("time","desc")
      .get()
      .then(snapshot=>{
        snapshot.forEach(doc=>{
          notesDiv.innerHTML +=
            `<div class="note">${doc.data().text}</div>`;
        });
      });
  }

  function logout(){
    auth.signOut();
    location.reload();
  }
</script>
</script>

</body>
</html>
